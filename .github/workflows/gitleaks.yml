name: Gitleaks Local Test

on:
  workflow_dispatch:  # so act can run it
  push:
    branches: [master]

jobs:
  gitleaks:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout full history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Gitleaks
        uses: gitleaks/gitleaks-action@v2
        env:
          GITLEAKS_ARGS: --report-format sarif --report-path gitleaks.sarif --verbose
          GITLEAKS_VERSION: 8.18.4

      - name: Verify SARIF file
        run: |
          if [ -f gitleaks.sarif ]; then
            echo "✅ SARIF file generated"
            ls -lh gitleaks.sarif
          else
            echo "❌ SARIF file not found"
            exit 1
          fi
